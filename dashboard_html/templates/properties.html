<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Intelligence - NYC Real Estate Intel</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/properties.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>üèôÔ∏è NYC Real Estate Intel</h1>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/construction" class="nav-link">üèóÔ∏è Construction</a>
                <a href="/investments" class="nav-link">üí∞ Investments</a>
                <a href="/properties" class="nav-link active">üè¢ Properties</a>
                <a href="/analytics" class="nav-link">üìä Analytics</a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-secondary" id="bulkEnrichBtn" onclick="showBulkEnrichModal()">
                    <i class="fas fa-phone"></i> Bulk Enrich
                </button>
                <button class="btn btn-primary" id="exportBtn">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Filters -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üîç Advanced Filters</h2>
                <button class="btn-clear" id="clearFiltersBtn">Clear All</button>
            </div>

            <!-- Universal Search -->
            <div class="filter-section">
                <h3>üîé Universal Search</h3>
                <input type="text" id="universalSearch" class="filter-input" 
                    placeholder="Address, BBL, Owner, ZIP...">
            </div>

            <!-- Owner Search -->
            <div class="filter-section">
                <h3>üë§ Owner Search</h3>
                <input type="text" id="ownerSearch" class="filter-input" 
                    placeholder="Search by owner name...">
                <small class="filter-hint">Click property to see full portfolio</small>
            </div>

            <!-- Value Range -->
            <div class="filter-section">
                <h3>üíµ Assessed Value</h3>
                <div class="range-inputs">
                    <input type="number" id="minValue" class="filter-input" placeholder="Min ($)">
                    <input type="number" id="maxValue" class="filter-input" placeholder="Max ($)">
                </div>
            </div>

            <!-- Sale Price Range -->
            <div class="filter-section">
                <h3>üè∑Ô∏è Sale Price</h3>
                <div class="range-inputs">
                    <input type="number" id="minSalePrice" class="filter-input" placeholder="Min ($)">
                    <input type="number" id="maxSalePrice" class="filter-input" placeholder="Max ($)">
                </div>
            </div>

            <!-- Sale Date Range -->
            <div class="filter-section">
                <h3>üìÖ Sale Date</h3>
                <div class="range-inputs">
                    <input type="date" id="saleDateFrom" class="filter-input">
                    <input type="date" id="saleDateTo" class="filter-input">
                </div>
            </div>

            <!-- Borough Filter -->
            <div class="filter-section">
                <h3>üó∫Ô∏è Borough</h3>
                <select id="boroughFilter" class="filter-select">
                    <option value="">All Boroughs</option>
                    <option value="1">Manhattan</option>
                    <option value="2">Bronx</option>
                    <option value="3">Brooklyn</option>
                    <option value="4">Queens</option>
                    <option value="5">Staten Island</option>
                </select>
            </div>

            <!-- Property Type (Residential/Commercial) -->
            <div class="filter-section">
                <h3>üè† Property Type</h3>
                <select id="propertyType" class="filter-select">
                    <option value="">All Types</option>
                    <option value="residential">Residential</option>
                    <option value="commercial">Commercial</option>
                    <option value="mixed">Mixed Use</option>
                </select>
                <small class="filter-hint">Filter by property category</small>
            </div>

            <!-- Building Class -->
            <div class="filter-section">
                <h3>üè¢ Building Class</h3>
                <input type="text" id="buildingClass" class="filter-input" 
                    placeholder="e.g., A, B, C, D">
                <small class="filter-hint">NYC building classification code</small>
            </div>

            <!-- Unit Range -->
            <div class="filter-section">
                <h3>üè† Units</h3>
                <div class="range-inputs">
                    <input type="number" id="minUnits" class="filter-input" placeholder="Min">
                    <input type="number" id="maxUnits" class="filter-input" placeholder="Max">
                </div>
            </div>

            <!-- Permit Activity -->
            <div class="filter-section">
                <h3>üèóÔ∏è Permit Activity</h3>
                <label class="checkbox-label">
                    <input type="checkbox" id="withPermits">
                    Only properties with permits
                </label>
                <input type="number" id="minPermits" class="filter-input" 
                    placeholder="Min permit count">
                
                <!-- Permit Type Filter -->
                <label class="filter-label" style="margin-top: 12px;">Permit Type</label>
                <select id="permitType" class="filter-select">
                    <option value="">All Types</option>
                    <option value="EW">EW - Equipment Work</option>
                    <option value="PL">PL - Plumbing</option>
                    <option value="EQ">EQ - Equipment</option>
                    <option value="AL">AL - Alteration</option>
                    <option value="NB">NB - New Building</option>
                    <option value="SG">SG - Sign</option>
                    <option value="DM">DM - Demolition</option>
                    <option value="FO">FO - Foundation</option>
                </select>
                
                <!-- Recent Permit Filter -->
                <label class="filter-label" style="margin-top: 12px;">Recent Permits</label>
                <select id="recentPermitDays" class="filter-select">
                    <option value="">Any time</option>
                    <option value="3">Last 3 days</option>
                    <option value="7">Last week</option>
                    <option value="30">Last 30 days</option>
                    <option value="60">Last 60 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="180">Last 6 months</option>
                    <option value="365">Last year</option>
                    <option value="730">Last 2 years</option>
                    <option value="custom">Custom...</option>
                </select>
                <input type="number" id="recentPermitCustomDays" class="filter-input" 
                    placeholder="# of days" style="display: none; margin-top: 8px;" min="1" max="3650">
            </div>

            <!-- Financing -->
            <div class="filter-section">
                <h3>üè¶ Financing Ratio</h3>
                <div class="range-inputs">
                    <input type="number" id="financingMin" class="filter-input" 
                        placeholder="Min (%)" min="0" max="100">
                    <input type="number" id="financingMax" class="filter-input" 
                        placeholder="Max (%)" min="0" max="100">
                </div>
            </div>

            <!-- Cash Purchase Filter -->
            <div class="filter-section">
                <label class="checkbox-label">
                    <input type="checkbox" id="cashOnly">
                    üíµ Cash purchases only
                </label>
            </div>

            <!-- HPD Violations -->
            <div class="filter-section">
                <h3>‚ö†Ô∏è HPD Violations</h3>
                <select id="violationsFilter" class="filter-select">
                    <option value="">Any</option>
                    <option value="true">Has violations</option>
                    <option value="false">No violations</option>
                </select>
            </div>

            <!-- Enrichable Owner Filter -->
            <div class="filter-section">
                <label class="checkbox-label">
                    <input type="checkbox" id="hasEnrichableOwner">
                    üìû Has enrichable owner
                </label>
                <small class="filter-hint">Properties with a person name (not LLC) that can be looked up</small>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <!-- Stats Dashboard -->
            <section class="stats-dashboard">
                <div class="stat-card">
                    <div class="stat-icon">üè¢</div>
                    <div class="stat-content">
                        <div class="stat-label">Total Properties</div>
                        <div class="stat-value" id="statTotal">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <div class="stat-label">Total Value</div>
                        <div class="stat-value" id="statValue">$0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíµ</div>
                    <div class="stat-content">
                        <div class="stat-label">Cash Purchases</div>
                        <div class="stat-value" id="statCash">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üÜï</div>
                    <div class="stat-content">
                        <div class="stat-label">Recent Sales (90d)</div>
                        <div class="stat-value" id="statRecent">0</div>
                    </div>
                </div>
            </section>

            <!-- Controls Bar -->
            <div class="controls-bar">
                <div class="results-info">
                    <span id="resultsCount">0 properties</span>
                </div>
                <div class="controls-right">
                    <label>Sort by:</label>
                    <select id="sortBy" class="control-select">
                        <option value="sale_date">Sale Date</option>
                        <option value="value">Assessed Value</option>
                        <option value="sale_price">Sale Price</option>
                        <option value="address">Address</option>
                        <option value="owner">Owner</option>
                        <option value="permits">Permit Count</option>
                        <option value="units">Units</option>
                    </select>
                    <select id="sortOrder" class="control-select">
                        <option value="desc">High to Low</option>
                        <option value="asc">Low to High</option>
                    </select>
                    <label>Per page:</label>
                    <select id="perPage" class="control-select">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                </div>
            </div>

            <!-- Properties Grid -->
            <div id="propertiesContainer" class="properties-grid">
                <!-- Property cards will be inserted here -->
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination controls will be inserted here -->
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading properties...</p>
            </div>

            <!-- No Results -->
            <div id="noResults" class="no-results" style="display: none;">
                <i class="fas fa-search"></i>
                <p>No properties found matching your criteria</p>
                <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
            </div>
        </main>
    </div>

    <!-- Owner Portfolio Modal -->
    <div id="portfolioModal" class="modal" style="display: none;">
        <div class="modal-content portfolio-modal">
            <div class="modal-header">
                <h2 id="portfolioOwnerName">Owner Portfolio</h2>
                <button class="modal-close" onclick="closePortfolioModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="portfolio-stats">
                    <div class="portfolio-stat">
                        <div class="portfolio-stat-label">Total Properties</div>
                        <div class="portfolio-stat-value" id="portfolioCount">0</div>
                    </div>
                    <div class="portfolio-stat">
                        <div class="portfolio-stat-label">Total Value</div>
                        <div class="portfolio-stat-value" id="portfolioValue">$0</div>
                    </div>
                    <div class="portfolio-stat">
                        <div class="portfolio-stat-label">Total Units</div>
                        <div class="portfolio-stat-value" id="portfolioUnits">0</div>
                    </div>
                    <div class="portfolio-stat">
                        <div class="portfolio-stat-label">Cash Purchases</div>
                        <div class="portfolio-stat-value" id="portfolioCash">0</div>
                    </div>
                </div>
                <div id="portfolioProperties" class="portfolio-list">
                    <!-- Portfolio properties will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal" style="display: none;">
        <div class="modal-content export-modal">
            <div class="modal-header">
                <h2>üì• Export Properties</h2>
                <button class="modal-close" onclick="closeExportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="export-info">
                    <p><strong id="exportCount">0</strong> properties match your current filters</p>
                    <p class="export-limit-note">Maximum 10,000 properties per export</p>
                </div>
                
                <div class="export-fields">
                    <h4>Select fields to export:</h4>
                    <div class="field-groups">
                        <div class="field-group">
                            <h5>üìç Property Info</h5>
                            <label><input type="checkbox" name="export_field" value="address" checked> Address</label>
                            <label><input type="checkbox" name="export_field" value="bbl" checked> BBL</label>
                            <label><input type="checkbox" name="export_field" value="borough" checked> Borough</label>
                            <label><input type="checkbox" name="export_field" value="zip_code"> Zip Code</label>
                            <label><input type="checkbox" name="export_field" value="building_class"> Building Class</label>
                            <label><input type="checkbox" name="export_field" value="year_built"> Year Built</label>
                            <label><input type="checkbox" name="export_field" value="units"> Units</label>
                        </div>
                        <div class="field-group">
                            <h5>üë§ Owner Info</h5>
                            <label><input type="checkbox" name="export_field" value="owner_name" checked> Owner Name</label>
                            <label><input type="checkbox" name="export_field" value="owner_phone"> Enriched Owner Phone (unlocked only)</label>
                            <label><input type="checkbox" name="export_field" value="owner_email"> Enriched Owner Email (unlocked only)</label>
                            <label><input type="checkbox" name="export_field" value="owner_address"> Owner Address</label>
                        </div>
                        <div class="field-group">
                            <h5>üìû Permit Contacts</h5>
                            <label><input type="checkbox" name="export_field" value="all_contacts"> All Contacts (Name, Role, Phone)</label>
                            <label><input type="checkbox" name="export_field" value="all_contact_phones"> All Contact Phones</label>
                            <label><input type="checkbox" name="export_field" value="contact_names"> Contact Names Only</label>
                        </div>
                        <div class="field-group">
                            <h5>üí∞ Financial</h5>
                            <label><input type="checkbox" name="export_field" value="assessed_value" checked> Assessed Value</label>
                            <label><input type="checkbox" name="export_field" value="sale_price" checked> Sale Price</label>
                            <label><input type="checkbox" name="export_field" value="sale_date" checked> Sale Date</label>
                            <label><input type="checkbox" name="export_field" value="is_cash_purchase"> Cash Purchase</label>
                        </div>
                        <div class="field-group">
                            <h5>üèóÔ∏è Activity</h5>
                            <label><input type="checkbox" name="export_field" value="permit_count"> Permit Count</label>
                            <label><input type="checkbox" name="export_field" value="violation_count"> Violation Count</label>
                        </div>
                    </div>
                </div>
                
                <div class="export-actions">
                    <button class="btn btn-secondary" onclick="closeExportModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="downloadExport()">
                        <i class="fas fa-download"></i> Download CSV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/properties.js"></script>
</body>
</html>
