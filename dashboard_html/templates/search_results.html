<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - NYC Real Estate Intel</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>üèôÔ∏è NYC Real Estate Intel</h1>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/construction" class="nav-link">üèóÔ∏è Construction</a>
                <a href="/investments" class="nav-link">üí∞ Investments</a>
                <a href="/properties" class="nav-link">üè¢ Properties</a>
                <a href="/analytics" class="nav-link">üìä Analytics</a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-secondary" onclick="window.location.href='/'">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
            </div>
        </div>
    </nav>

    <!-- Search Header -->
    <section class="search-header" style="background: var(--bg-secondary); padding: var(--spacing-xl) 0; border-bottom: 1px solid var(--border-color);">
        <div class="container">
            <h1 style="font-size: 1.75rem; margin-bottom: var(--spacing-md);">Search Results</h1>
            <div class="search-bar-large">
                <i class="fas fa-search search-icon"></i>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input-large" 
                    placeholder="Search again..."
                    value="{{ query }}"
                >
                <button class="btn btn-primary search-btn" onclick="performSearch()">Search</button>
            </div>
            <div id="resultsCount" style="margin-top: var(--spacing-md); color: var(--text-muted);"></div>
        </div>
    </section>

    <!-- Results -->
    <section style="padding: var(--spacing-2xl) 0;">
        <div class="container">
            <div id="resultsContainer" style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                <div class="loading-state">Loading results...</div>
            </div>
        </div>
    </section>

    <script>
        const searchQuery = "{{ query }}";
        
        document.addEventListener('DOMContentLoaded', () => {
            loadResults();
            
            // Allow Enter key to search
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        });
        
        async function loadResults() {
            try {
                const response = await fetch(`/api/search?q=${encodeURIComponent(searchQuery)}`);
                const results = await response.json();
                
                const container = document.getElementById('resultsContainer');
                const countEl = document.getElementById('resultsCount');
                
                countEl.textContent = `Found ${results.length} result${results.length !== 1 ? 's' : ''} for "${searchQuery}"`;
                
                if (results.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: var(--spacing-2xl); color: var(--text-muted);">
                            <i class="fas fa-search" style="font-size: 3rem; opacity: 0.3; margin-bottom: var(--spacing-md);"></i>
                            <p style="font-size: 1.125rem; margin-bottom: var(--spacing-sm);">No results found</p>
                            <p>Try a different search term or check your spelling</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = results.map(result => `
                    <div class="info-card" style="cursor: pointer; transition: all var(--transition-base);" 
                         onclick="window.location.href='/property/${result.bbl}'"
                         onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.15)'"
                         onmouseout="this.style.transform=''; this.style.boxShadow=''">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: var(--spacing-sm); color: var(--text-primary);">
                                    ${result.address || 'Address Unknown'}
                                </h3>
                                <div style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">
                                    <strong>Owner:</strong> ${result.owner || 'Unknown'}
                                </div>
                                
                                <!-- Match Reasons -->
                                ${result.match_reasons && result.match_reasons.length > 0 ? `
                                    <div style="margin: var(--spacing-sm) 0;">
                                        <div style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.25rem; font-weight: 600;">
                                            Why this matched:
                                        </div>
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.375rem;">
                                            ${result.match_reasons.map(reason => `
                                                <span style="background: var(--bg-tertiary); color: var(--primary); padding: 0.25rem 0.625rem; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: 600; border: 1px solid var(--primary-light);">
                                                    ${reason}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div style="display: flex; gap: var(--spacing-md); color: var(--text-muted); font-size: 0.875rem; margin-top: var(--spacing-sm);">
                                    <span><i class="fas fa-building"></i> BBL: ${formatBBL(result.bbl)}</span>
                                    <span><i class="fas fa-file-alt"></i> ${result.permits || 0} permit${result.permits !== 1 ? 's' : ''}</span>
                                    ${result.assessed_value ? `<span><i class="fas fa-dollar-sign"></i> $${formatNumber(result.assessed_value)}</span>` : ''}
                                </div>
                            </div>
                            <div style="color: var(--primary); font-size: 1.5rem;">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading results:', error);
                document.getElementById('resultsContainer').innerHTML = `
                    <div style="text-align: center; padding: var(--spacing-2xl); color: var(--secondary);">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: var(--spacing-md);"></i>
                        <p>Error loading results. Please try again.</p>
                    </div>
                `;
            }
        }
        
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                window.location.href = `/search-results?q=${encodeURIComponent(query)}`;
            }
        }
        
        function formatBBL(bbl) {
            if (!bbl) return '';
            const bblStr = bbl.toString();
            if (bblStr.length === 10) {
                return `${bblStr[0]}-${bblStr.substr(1, 5)}-${bblStr.substr(6, 4)}`;
            }
            return bblStr;
        }
        
        function formatNumber(num) {
            if (!num) return '0';
            return Math.round(num).toLocaleString();
        }
    </script>
</body>
</html>
